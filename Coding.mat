%% Declaration
clear all;
close all;
warning off;
clc;
 tic
w = 20;
pl_const = 174;
wlm = 2e-13;
noise_power_spectrum_density = -174;
glm = 2.5e-10;
ml = 5;
el = 0.8;
sigma_lmin = 1;
lamda_0 = 1;
k_l = 0.5;

p_l = 1 + (174-1).*rand(1,10000);
  p_l = sort(p_l,'ascend');
eeta_lmin = 1;

%% System Model
macro_x = 1000;
macro_y = 1000;
figure('name','System Model');
hold on;
plot(macro_x,macro_y,'ks','Linewidth',2);
circle(macro_x,macro_y,1000);
small_x = [200 250 246 1486 245 315 555 1458 552 792 328 526 348 792 ...
    456 243 215 1860 486 674 726 1750 200 250 246 1486 245 315 555 ...
    1458 552 792 328 526 348 792 456 243 215 1860 486 674 726 1750 ...
    484 786 324 1900 789 364 599];
small_y = [1400 456 463 489 0987 498 972 949 764 980 791 974 987 672 ...
    498 567 649 698 945 743 965 798 934 642 826 492 949 900 544 ...
    598 998 1583 988 879 987 563 849 791 596 972 483 781 484 957 ...
    596 973 494 954 652 567 498];
for i = 1:length(small_x)
    hold on;
    plot(small_x(i),small_y(i),'r.');
    circle(small_x(i),small_y(i),50);    
end
for i = 1:length(small_x)
    hold on;
    plot(small_y(i)+200,(small_x(i))+50,'r.');
    circle(small_y(i)+200,(small_x(i))+50,50);
end
xlim([-200 2200])
ylim([-200 2200])
title('Ultra-dense heterogeneous and small cell networks');
xlabel('Area-Length')
ylabel('Area-Width')

%% Capacity, Spectral Efficiency and Energy efficiency, Trade off

loopterm = 0;
for m = 1:ml
    loopterm = loopterm + (wlm/glm);
end

wl_bar = (1/ml) * loopterm;     % Average normalized undesired power
% Convergence
m_l = [1 2];

for i = 1:2
    ml = m_l(i);
    for j = 1:length(p_l)
    
    pl = p_l(j);
    cl_m = w * 2.303 * log(1+(pl/wl_bar));
    cl = ml * cl_m;  % Capacity
    pi_l(j) = cl / w; % Spectral Efficiency
      eeta_l(j) = cl/((el*pl)+(pl_const));  % Energy Effiency
   
    end
figure('name','Convergences');
hold on;
  if i == 1
      plot(pi_l,eeta_l,'k.');  
      title('Convergence Verification and Effectiveness at ml = 1');
       
  else
      plot(pi_l,eeta_l,'r.');
      title('Convergence Verification and Effectiveness at ml = 2');
  end
xlabel('Spectral Efficiency');
ylabel('Energy Efficiency');
end

 %% Trade off
 figure('name','Tradeoff');
hold on;
ml = 5;

% mu_l and sigma_l

 for j = 1:length(p_l)
     pl = p_l(j);
     pl = wl_bar * ((exp(pi_l(j)/ml))-1);
     mu_l = el * wl_bar / w;
     sigma_l = pl_const/w;
     si_l = mu_l * (exp(pi_l(j)/ml)-1);
     eeta_l1(j) = pi_l(j)/(si_l + sigma_l);
 end
 plot(pi_l(1:1000),sort(eeta_l1(1:1000),'descend'),'b.','Linewidth',2);
 title('Tradeoff Relationships of the proposed CE2MG scheme with mu_l and sigma_l')
 xlabel('Spectral Efficiency');
ylabel('Energy Efficiency');
 
 figure('name','Tradeoff');
hold on;

% 2 * mu_l and sigma_l

 for j = 1:length(p_l)
     pl = p_l(j);
     pl = wl_bar * ((exp(pi_l(j)/ml))-1);
     mu_l = el * wl_bar / w;
     sigma_l = pl_const/w;
     si_l = (2*mu_l) * (exp(pi_l(j)/ml)-1);
     eeta_l2(j) = pi_l(j)/(si_l + sigma_l);
 end

plot(pi_l(1:1000),sort(eeta_l2(1:1000),'descend'),'r-.','Linewidth',2);
 title('Tradeoff Relationships of the proposed CE2MG scheme with 2*mu_l and sigma_l');
 xlabel('Spectral Efficiency');
ylabel('Energy Efficiency');
 
 figure('name','Tradeoff');
hold on;

% mu_l and 2 * sigma_l

 for j = 1:length(p_l)
     pl = p_l(j);
     pl = wl_bar * ((exp(pi_l(j)/ml))-1);
     mu_l = el * wl_bar / w;
     sigma_l = pl_const/w;
     si_l = (mu_l) * (exp(pi_l(j)/ml)-1);
     eeta_l3(j) = pi_l(j)/(si_l + (2*sigma_l));
 end

plot(pi_l(1:1000),sort(eeta_l3(1:1000),'descend'),'k-..','Linewidth',2);
 title('Tradeoff Relationships of the proposed CE2MG scheme with mu_l and 2*sigma_l')
 xlabel('Spectral Efficiency');
ylabel('Energy Efficiency');

figure('name','Tradeoff');
hold on;

 plot(pi_l(1:1000),sort(eeta_l1(1:1000),'descend'),'b.','Linewidth',2);
 plot(pi_l(1:1000),sort(eeta_l2(1:1000),'descend'),'r-.','Linewidth',2);
plot(pi_l(1:1000),sort(eeta_l3(1:1000),'descend'),'k-..','Linewidth',2);
title('Tradeoff Relationships of the proposed CE2MG scheme');
 xlabel('Spectral Efficiency');
ylabel('Energy Efficiency');

 %% L number of SeNBs

% L = 1:1:600;
L = 1:1:length(p_l);
 sumterm = 0;
 clear eeta_l;
 figure('name','L no. of SeNBs');
 hold on;
 
  for j = 1:length(p_l)
     pl = wl_bar * ((exp(pi_l(j)/ml))-1);
     mu_l(j) = el * wl_bar / w;
     sigma_l(j) = pl_const/w;
     si_l(j) = mu_l(j) * (exp(pi_l(j)/ml)-1);
     eeta_l(j) = pi_l(j)/(si_l(j) + sigma_l(j));
     eeta2_l(j) = (eeta_l(j))^2;
     avg(j) = eeta_l(j)/length(L);
     dem(j) = length(L) * eeta2_l(j);
      J(j) = avg(j)/dem(j);
  end

plot(L(1:2000),eeta_l(1:2000),'b-','Linewidth',2);
title('Effects of Densification on the System EE');
xlabel('L - No. of SeNBs');
ylabel('eeta');


figure('name','L no. of SeNBs');

plot(L,J,'r-','Linewidth',2);
title('Effects of Densification on the Average individual EE');
xlabel('L - No. of SeNBs');
ylabel('eeta');


figure('name','Power');
plot(L(1:20),eeta_l(1:20),'b-','Linewidth',2);
title('Power Utilization');
xlabel('No of cycles');
ylabel('Power in %');

%% Performance of the Jain's fairness index
lamda(1) = lamda_0;
kl(1) = k_l;
L_val = 1:1:200;
figure('name','CE2MG Algorithm')
for l = 1:length(L_val)
    wmalg(l) = p_l(l)*glm;
    wl_baralg(l) = (1/ml)*(sum(wmalg/glm));
    pi_lalg(l) = 2.303 * (log(1+p_l(l)/wl_baralg(l)));
    mualg(l) = el * wl_baralg(l);
    sialg(l) = mualg(l)*(exp(pi_lalg(l)/ml)-1);
    sigma_l = pl_const/w;
    lamda(l+1) = lamda(l) + (pi - sum(pi_lalg));
    kl(l+1) = kl(l) + (pi_lalg(l) - max(pi_lalg));
    % Spectral Efficiency
    pilalg(l) = ml * (((sialg(l)+sigma_l)*(lamda(l)-kl(l))*eeta_lmin)+1)/ ...
        (((sialg(l)+mualg(l))/(sialg(l)+sigma_l))+(ml*(lamda(l)-kl(l))));
    % Energy Efficiency
    eeta_lalg(l) = pilalg(l)/(sialg(l) + sigma_l);
    
    eeta2_lalg(l) = (eeta_lalg(l))^2;
     avgalg(l) = eeta_lalg(l)/length(L_val);
     demalg(l) = max(L_val) * eeta2_lalg(l);
      Jalg(l) = avgalg(l)/demalg(l);
end
plot(L_val,sort(Jalg,'descend'),'b','Linewidth',2);
xlabel('L - No. of SeNBs');
ylabel('J');
title('Jain fairness index J');
figure('name','Performance');
hold on;

plot(L_val,sort(Jalg,'descend'),'b','Linewidth',2)
plot(L(1:200),10000*sort(J(1:200),'descend'),'r-','Linewidth',2);
xlabel('L - No. of SeNBs');
ylabel('J');
title('Jain fairness index J');
legend('CE2MG','Non-CE2MG');

%% Ratio of EE to SE
L = 1:1:200;
figure('name','CE2MG')
for i = 1:length(L)
    ce2mg(i) = eeta_lalg(i)/pilalg(i);
    non_ce2mg(i) = eeta_l(i)/pi_l(i);
end
plot(L,ce2mg,'r','Linewidth',2);
xlabel('L - No. of SeNBs');
ylabel('Ratio of EE to SE');
title('Ratio of EE to SE in existing algorithm');

figure('name','Performance')
hold on;
plot(L,non_ce2mg,'b','Linewidth',2);
plot(L,ce2mg,'r','Linewidth',2);
xlabel('L - No. of SeNBs');
ylabel('Ratio of EE to SE');
title('Performance of the EE vs. SE tradeoffs');
legend('Proposed','Previous')
toc
